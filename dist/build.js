!function(e,t){function s(t,r){if("."!=t[0]&&"/"!=t[0])return e(t);r=r||"root";var n=s.resolve(t);if(!n&&/\.json$/i.test(t))return e("./"+s.basename(t));var o=s.cache[n];if(!o)try{return e(t)}catch(e){throw new Error('failed to require "'+t+'" from '+r+"\n"+e.message+"\n"+e.stack)}return o.exports||(o.exports={},o.call(o.exports,o,o.exports,s.relative(n))),o.exports}s.cache={},s.basename=e("path").basename,s.resolve=function(t){if("."!=t[0])return e.resolve(t);var r="/"===t.slice(-1)?t:t+"/",n=[t,t+".js",r+"index.js",t+".json",r+"index.json"];for(var o in n){var i=n[o];if(s.cache[i])return i}},s.register=function(e,t){s.cache[e]=t},s.relative=function(e){function t(t){if("."!=t[0])return s(t);var r=e.split("/"),n=t.split("/");for(var o in r.pop(),n){var i=n[o];".."==i?r.pop():"."!=i&&r.push(i)}return s(r.join("/"),e)}return t.resolve=s.resolve,t.cache=s.cache,t},s.register("./main.js",function(e,t,s){"use strict";e.exports={SECRET:"hiit-cityscan-secret-passphrase",MONGODB_URI:"mongodb://demo:demo@ds251737.mlab.com:51737/cityscan",PORT:process.env.PORT||5050,PORT_BROWSER_SYNC:3e3,PORT_NODEMON:8e3,CORS:{origin:"*",methods:"PUT, GET, POST, DELETE, OPTIONS",headers:"Origin, X-Requested-With, Content-Type, Accept, Authorization, Access-Control-Allow-Credentials",credentials:"true"}}}),s.register("./passport.js",function(e,t,s){"use strict";var r=s("passport"),n=s("../models/user"),o=s("./main"),i=s("passport-jwt").Strategy,u=s("passport-jwt").ExtractJwt,a=new(s("passport-local"))({usernameField:"email"},function(e,t,s){n.findOne({email:e},function(e,r){return e?s(e):r?void r.comparePassword(t,function(e,t){return e?s(e):t?s(null,r):s(null,!1,{error:"Your login details could not be verified. Please try again."})}):s(null,!1,{error:"Your login details could not be verified. Please try again."})})}),l=new i({jwtFromRequest:u.fromAuthHeader(),secretOrKey:o.SECRET},function(e,t){n.findById(e._id,function(e,s){if(e)return t(e,!1);t(null,s||!1)})});r.use(a),r.use(l)}),s.register("./constants.js",function(e,t,s){"use strict";e.exports={ROLES:{CLIENT:"CLIENT",ADMIN:"ADMIN"},PERMISSIONS:{READ_USERS:"READ_USERS",WRITE_USERS:"WRITE_USERS"}}}),s.register("./permission.js",function(e,t,s){"use strict";var r,n=s("mongoose"),o=(r=n)&&r.__esModule?r:{default:r};var i=new(0,o.default.Schema)({label:{type:String,required:!0}});e.exports=o.default.model("Permission",i)}),s.register("./role.js",function(e,t,s){"use strict";var r,n=s("mongoose"),o=(r=n)&&r.__esModule?r:{default:r},i=s("../constants");var u=o.default.Schema,a=new u({label:{type:String,enum:[i.ROLES.ADMIN,i.ROLES.CLIENT],required:!0},permissions:[{type:u.Types.ObjectId,ref:"Permission"}]});e.exports=o.default.model("Role",a)}),s.register("./user.js",function(e,t,s){"use strict";var r=o(s("bcrypt-nodejs")),n=o(s("mongoose"));function o(e){return e&&e.__esModule?e:{default:e}}var i=n.default.Schema,u=new i({email:{type:String,lowercase:!0,unique:!0,required:!0},password:{type:String,required:!0},firstName:{type:String},lastName:{type:String},role:{type:i.Types.ObjectId,ref:"Role"},resetPasswordToken:{type:String},resetPasswordExpires:{type:Date}},{timestamps:!0});u.pre("save",function(e){var t=this;if(!t.isModified("password"))return e();r.default.genSalt(5,function(s,n){if(s)return e(s);r.default.hash(t.password,n,null,function(s,r){if(s)return e(s);t.password=r,e()})})}),u.methods.comparePassword=function(e,t){r.default.compare(e,this.password,function(e,s){if(e)return t(e);t(null,s)})},e.exports=n.default.model("User",u)}),s.register("./util.service.js",function(e,t,s){"use strict";e.exports={setUserInfo:function(e){return{_id:e._id,updatedAt:e.updatedAt,createdAt:e.createdAt,firstName:e.firstName,lastName:e.lastName,email:e.email,role:e.role}}}}),s.register("./auth.controller.js",function(e,t,s){"use strict";var r=a(s("jsonwebtoken")),n=a(s("../models/user")),o=a(s("../config/main")),i=s("../services/util.service"),u=s("lodash");function a(e){return e&&e.__esModule?e:{default:e}}function l(e){return r.default.sign(e,o.default.SECRET,{expiresIn:3600})}s("crypto");var d={path:"role",populate:{path:"permissions"}};e.exports=function(){return{login:function(e,t,s){e.user.populate({path:"role",populate:{path:"permissions"}},function(r){if(r)return s(r);var n=(0,i.setUserInfo)(e.user);t.status(200).json({token:"JWT  "+l(n),user:n}),s()})},hasAuthorization:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e=[].concat([],e),t=[].concat([],t),function(s,r,o){var i=s.user;n.default.findById(i._id).populate("role").exec(function(s,n){if(s)return r.status(422).json({error:"No user found."}),o(s);var i=n.role.permissions.map(function(e){return e.label});return e.indexOf(n.role.label)>-1||(0,u.intersection)(t,i).length>0?o():(r.status(401).json({error:"You are not authorized to view this content"}),o("Unauthorized"))})}},register:function(e,t,s){var r=e.body.email,o=e.body.firstName,u=e.body.lastName,a=e.body.password,c=e.body.role;return r?o&&u?a?void n.default.findOne({email:r},function(e,f){return e?s(e):f?t.status(422).send({error:"That email address is already in use."}):void new n.default({email:r,password:a,firstName:o,lastName:u,role:c}).save(function(e,r){if(e)return s(e);r.populate(d,function(e){if(e)return s(e);var n=(0,i.setUserInfo)(r);t.status(201).json({token:"JWT  "+l(n),user:n})})})}):t.status(422).send({error:"You must enter a password."}):t.status(422).send({error:"You must enter your full name."}):t.status(422).send({error:"You must enter an email address."})}}}}),s.register("./permission.controller.js",function(e,t,s){"use strict";var r,n=s("../models/permission"),o=(r=n)&&r.__esModule?r:{default:r};e.exports=function(){return{add:function(e,t,s){var r=e.body.label;if(!r)return t.status(422).send({error:"You must enter a permission label."});o.default.findOne({label:r},function(e,n){e?t.status(500).send(e):n?t.status(422).json({error:"This permission already exists."}):new o.default({label:r}).save(function(e,r){if(e)return s(e);t.status(201).json(r)})})},edit:function(e,t){e.permission.label=e.body.label,e.permission.save(function(e,s){e?t.status(500).send(e):t.json(s)})},find:function(e,t){t.json(e.permission)},findAll:function(e,t){o.default.find({},function(e,s){e?t.status(500).send(e):t.json(s)})},middleware:function(e,t,s){o.default.findById(e.params.id,function(r,n){r?t.status(500).send(r):n?(e.permission=n,s()):t.status(404).send("No permission found")})},remove:function(e,t){e.permission.remove(function(e){e?t.status(500).send(e):t.status(204).send("Successfully removed")})}}}}),s.register("./role.controller.js",function(e,t,s){"use strict";var r,n=s("../models/role"),o=(r=n)&&r.__esModule?r:{default:r};e.exports=function(){return{add:function(e,t,s){var r=e.body.label,n=e.body.permissions?e.body.permissions:[];if(!r)return t.status(422).send({error:"You must enter a role label."});o.default.findOne({label:r},function(e,i){if(e)t.status(500).send(e);else if(i)t.status(422).json({error:"This role already exists."});else{var u=new o.default({label:r,permissions:n});u.save(function(e){if(e)return s(e);u.populate("permissions",function(e,s){t.status(201).json(s)})})}})},edit:function(e,t){e.role.label=e.body.label,e.role.permissions=e.body.permissions,e.role.save(function(e,s){e?t.status(500).send(e):t.json(s)})},find:function(e,t){t.json(e.role)},findAll:function(e,t){o.default.find({}).populate("permissions").exec(function(e,s){e?t.status(500).send(e):t.json(s)})},middleware:function(e,t,s){o.default.findById(e.params.id).populate("permissions").exec(function(r,n){r?t.status(500).send(r):n?(e.role=n,s()):t.status(404).send("No role found")})},remove:function(e,t){e.role.remove(function(e){e?t.status(500).send(e):t.status(204).send("Successfully removed")})}}}}),s.register("./user.controller.js",function(e,t,s){"use strict";var r=u(s("../models/user")),n=s("../services/util.service"),o=u(s("nightmare")),i=u(s("jquery"));function u(e){return e&&e.__esModule?e:{default:e}}var a=new o.default({show:!0}),l={path:"role",populate:{path:"permissions"}};e.exports=function(){return{add:function(e,t,s){},edit:function(e,t){e.user.set(e.body),e.user.save(function(e,s){e?t.status(500).send(e):s.populate(l,function(e){e?t.status(500).send(e):t.json((0,n.setUserInfo)(s))})})},find:function(e,t){t.json((0,n.setUserInfo)(e.user))},findAll:function(e,t){r.default.find({}).populate(l).exec(function(e,s){if(e)t.status(500).send(e);else{var r=s.map(function(e){return(0,n.setUserInfo)(e)});t.json(r)}})},middleware:function(e,t,s){r.default.findById(e.params.id).populate(l).exec(function(r,n){r?t.status(500).send(r):n?(e.user=n,s()):t.status(404).send("No role found")})},remove:function(e,t){e.user.remove(function(e){e?t.status(500).send(e):t.status(204).send("Successfully removed")})},scan:function(){a.goto("http://www.seloger.com/").wait(2e3).type('.jsInlineContainer input[type="text"]',"paris").wait(1e3).evaluate(function(){(0,i.default)('.jsInlineContainer input[type="text"]').focus(),(0,i.default)(".selectize-dropdown")[0].style.display="block"}).wait(3e3).evaluate(function(){(0,i.default)(".optionContainer").get(0).click()}).wait(1e3).click(".b-btn.b-warn").wait(3e3).evaluate(function(){return Array.from((0,i.default)(".c-pa-list")).map(function(e){var t={};return t.price=(0,i.default)(e).find(".c-pa-price").text(),t})}).end().then(function(e){e.forEach(function(e){})}).catch(function(e){})}}}}),s.register("./user.controller.spec.js",function(e,t,s){"use strict";var r=s("sinon");describe("Book Controller Tests",function(){describe("Post",function(){it("should not allow an empty title on post",function(){var e={status:r.spy(),send:r.spy()};s("./bookController")(function(){(void 0).save=function(){}}).post({body:{author:"Youness"}},e),e.status.calledWith(400).should.equal(!0,"Bad Status "+e.status.args[0][0]),e.send.calledWith("Title is required").should.equal(!0)})})})}),s.register("./auth.router.js",function(e,t,s){"use strict";var r=o(s("express")),n=o(s("passport"));function o(e){return e&&e.__esModule?e:{default:e}}s("../config/passport");var i=s("../controllers/auth.controller")(),u=n.default.authenticate("local",{session:!1});e.exports=function(){var e=new r.default.Router;return e.post("/register",i.register),e.post("/login",u,i.login),e}}),s.register("./permission.router.js",function(e,t,s){"use strict";var r=s("../constants"),n=i(s("express")),o=i(s("passport"));function i(e){return e&&e.__esModule?e:{default:e}}s("../config/passport");var u=s("../controllers/permission.controller")(),a=s("../controllers/auth.controller")(),l=o.default.authenticate("jwt",{session:!1});e.exports=function(){var e=new n.default.Router;return e.use(l,a.hasAuthorization(r.ROLES.ADMIN)),e.post("/",u.add),e.get("/",u.findAll),e.use("/:id",u.middleware),e.get("/:id",u.find),e.put("/:id",u.edit),e.delete("/:id",u.remove),e}}),s.register("./role.router.js",function(e,t,s){"use strict";var r=s("../constants"),n=i(s("express")),o=i(s("passport"));function i(e){return e&&e.__esModule?e:{default:e}}s("../config/passport");var u=s("../controllers/role.controller")(),a=s("../controllers/auth.controller")(),l=o.default.authenticate("jwt",{session:!1});e.exports=function(){var e=new n.default.Router;return e.use(l,a.hasAuthorization(r.ROLES.ADMIN,r.PERMISSIONS.READ_USERS)),e.post("/",u.add),e.get("/",u.findAll),e.use("/:id",u.middleware),e.get("/:id",u.find),e.put("/:id",u.edit),e.delete("/:id",u.remove),e}}),s.register("./user.router.js",function(e,t,s){"use strict";var r=i(s("express")),n=i(s("passport")),o=s("../constants");function i(e){return e&&e.__esModule?e:{default:e}}s("../config/passport");var u=s("../controllers/user.controller")(),a=s("../controllers/auth.controller")(),l=n.default.authenticate("jwt",{session:!1});e.exports=function(){var e=new r.default.Router;return e.use(l,a.hasAuthorization(o.ROLES.ADMIN)),e.get("/",u.findAll),e.get("/",u.scan),e.use("/:id",u.middleware),e.get("/:id",u.find),e.put("/:id",u.edit),e.delete("/:id",u.remove),e}}),s.register("./app.js",function(e,t,s){"use strict";var r,n=s("express"),o=(r=n)&&r.__esModule?r:{default:r};var i=s("compression"),u=(0,o.default)(),a=s("body-parser"),l=s("morgan"),d=s("mongoose"),c=s("./config/main"),f=s("./routers/auth.router")(),p=s("./routers/user.router")(),m=s("./routers/role.router")(),v=s("./routers/permission.router")();d.connect(c.MONGODB_URI),"test"===process.env.ENV||(d.connect(process.env.MONGODB_URI||c.MONGODB_URI),u.listen(process.env.PORT||c.PORT)),u.use(a.urlencoded({extended:!1})),u.use(a.json()),u.use(l("dev")),u.use(i()),u.use(function(e,t,s){t.header("Access-Control-Allow-Origin",c.CORS.origin),t.header("Access-Control-Allow-Methods",c.CORS.methods),t.header("Access-Control-Allow-Headers",c.CORS.headers),t.header("Access-Control-Allow-Credentials",c.CORS.credentials),s()});var h=new o.default.Router;u.use("/api",h),h.use("/auth",f),h.use("/user",p),h.use("/role",m),h.use("/permission",v),u.use(o.default.static("public"))}),t.exports=s("./dist/app.js")}(require,module);